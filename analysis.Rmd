---
title: "Selfcare Study"
author: "Michael Shyne"
date: "05/28/2015"
output:
  html_document:
    keep_md: yes
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(comment=NA,
                      echo=FALSE, warning=FALSE, message=FALSE)
```


```{r}
require(dplyr, quiet=T, warn=F)
require(xtable)
require(knitr)
require(ggplot2)
require(gridExtra)

sc <- read.csv('selfcare_processed.csv')
sc.a <- filter(sc, group=="A")
sc.b <- filter(sc, group=="B")
sc12 <- filter(sc, section != 3)
sc12.a <- filter(sc12, group=="A")
sc12.b <- filter(sc12, group=="B")
```

## Data

The data for this study was comprised of "pre" and "post" self-care assessments (Health Promoting Lifestyle Profile II) given near the beginning and near the end of the semester, respectively, of a graduate level nursing theory class along with self-identified demographic information. The assessments were anonymous. "Pre" and "post" assessments were matched using secret codes, a short word or number selected by each subject. There were four sections of the class, separated into two groups randomly. Both groups were instructed on the importance of self-care and asked to write a reflective summary of their self-care activities. In addition, subjects in group A were required to create and implement a self-care plan based on the findings of the initial assessment.

The Health-Promoting Lifestyle Profile II (HPLP II) consists of 52 Likert scale questions with 4 possible answers, never (N), sometimes (S), often (O) and routinely (R). The HPLP II generates seven scores, an overall score and categorical scores for health responsibility, physical activity, nutrition, spiritual growth, interpersonal relations and stress management.  The scores are calculated by rendering each answer as a number, 1 for never, 2 for sometimes, 3 for often and 4 for routinely, and taking the mean of all answers for the overall score or the mean of a specified collection of answers for each category score.

Addition demographic information collected included years working as an RN, gender, age and race/ethnicity.

The question of interest is whether group A scores increased more than group B.

### Notes on data entry

An effort was made to enter demographic data exactly as written on the assessment forms, with the following exceptions:

- Assessments which did not have exactly matching codes but were determined to be probable matches were given identical codes.
- Gender was always entered as "m" or "f" or left blank.
- For numeric information (years RN and age), fractions and months were entered as approximate decimals (i.e., "2 months" as 0.16). Values such as "< 1" were entered as 0 and "30+" were left blank.
- Race/ethnicity was entered as written except in all lowercase for simplicity.

HPLP II answers were entered as numbers as specified above. Missing answers or multiple answers (if not clear which is intended) were left blank.

The raw data was saved in `selfcaredata.csv`.

### Processing data

The processing of the raw data is performed by the script `process.R`.

The gender values were given labels of "Female", "Male" and missing (NA). The race values were categorized into labels "White", "Black", "Other" and missing (NA). The following entered values were categorized as "White":

- white
- white/caucasian
- white/non-hispanic
- caucasian 
- cauc.
- caucation
- causasian

The following entered values were categorized as "Black":

- black
- black american
- aa
- african
- african american
- b

The following entered values were categorized as "Other":

- asian
- biracial
- hispanic
- indian
- white/asian
- white/black

Missing values include blank entries and one entry of "human race".

The demographic information was standardized (same values for "pre" and "post assessment rows) for each subject using values from "pre" assessment unless missing.

The HPLP II scores were calculated by taking the mean of the appropriate answers (ignoring missing values) as follows:

- **Overall** (overall): All answers, 1 - 52
- **Health Responsibility** (hr): Answers 3, 9, 15, 21, 27, 33, 39, 45, 51
- **Physical Activity** (pa): Answers 4, 10, 16, 22, 28, 34, 40, 46
- **Nutrition** (n): Answers 2, 8, 14, 20, 26, 32, 38, 44, 50
- **Spiritual Growth** (sg): Answers 6, 12, 18, 24, 30, 36, 42, 48, 52
- **Interpersonal Relations** (ir): Answers 1, 7, 13, 19, 25, 31, 37, 43, 49
- **Stress Management** (sm): Answers 5, 11, 17, 23, 29, 35, 41, 47

The data set was transformed so that each subject occupied one row, with standardized demographic information and the seven HPLP II scores from the "pre" assessment and the seven HPLP II scores from the "post" assessment. Seven "delta" scores were calculated by subtracting the "pre" scores from the "post" scores.

One subject was removed (code "1326") because one half of the "post" assessment was not completed.

The processed data set was saved as `selfcare_processed.csv`.

### Data characteristics

```{r, results='asis'}
m.n <- matrix(c(nrow(sc),nrow(sc.a), nrow(sc.b)), 
            ncol=3, dimnames=list(c("n"), c("Total", "Group A", "Group B")))
m <- rbind(m.n, Female=c(sum(sc$gender=="Female",na.rm=T), sum(sc.a$gender=="Female", na.rm=T),
                     sum(sc.b$gender=="Female", na.rm=T)))
m <- rbind(m, Male=c(sum(sc$gender=="Male",na.rm=T), sum(sc.a$gender=="Male", na.rm=T),
                     sum(sc.b$gender=="Male", na.rm=T)))
m <- rbind(m, "Gender missing"=c(sum(is.na(sc$gender)), sum(is.na(sc.a$gender)),
                     sum(is.na(sc.b$gender))))
m <- rbind(m, White=c(sum(sc$race=="White",na.rm=T), sum(sc.a$race=="White", na.rm=T),
                     sum(sc.b$race=="White", na.rm=T)))
m <- rbind(m, Black=c(sum(sc$race=="Black",na.rm=T), sum(sc.a$race=="Black", na.rm=T),
                     sum(sc.b$race=="Black", na.rm=T)))
m <- rbind(m, Other=c(sum(sc$race=="Other",na.rm=T), sum(sc.a$race=="Other", na.rm=T),
                     sum(sc.b$race=="Other", na.rm=T)))
m <- rbind(m, "Race missing"=c(sum(is.na(sc$race)), sum(is.na(sc.a$race)),
                     sum(is.na(sc.b$race))))

m.tab1 <- kable(m.n)
m.tab2 <- kable(m[2:4,])
m.tab3 <- kable(m[5:8,])

m.tab1
m.tab2
m.tab3
```

```{r, fig.height=3, fig.width=9}
g1 <- ggplot(data=sc, aes(x=age, fill=group))
g1 <- g1 + stat_density(alpha=.3, position = "identity")
g1 <- g1 + geom_histogram(aes(y=..density..),position="dodge")
g1 <- g1 + scale_fill_manual(values = c("red", "blue"))
g1 <- g1 + ggtitle("Age distribution")

g2 <- ggplot(data=sc, aes(x=yearsrn, fill=group))
g2 <- g2 + stat_density(alpha=.3, position = "identity")
g2 <- g2 + geom_histogram(aes(y=..density..),position="dodge")
g2 <- g2 + scale_fill_manual(values = c("red", "blue"))
g2 <- g2 + ggtitle("Year RN distribution")

grid.arrange(g1, g2, ncol=2)
```

## Analysis

### Compare demographic data between groups

#### Years RN (with section 3)
```{r}
sc.a.sum <- summary(sc.a$yearsrn)
sc.b.sum <- summary(sc.b$yearsrn)
sc.yearsrn.sum <- array(c(sc.a.sum[1], sc.b.sum[1],
                          sc.a.sum[3], sc.b.sum[3],
                          sc.a.sum[6], sc.b.sum[6],
                          sc.a.sum[4], sc.b.sum[4],
                          sd(sc.a$yearsrn, na.rm=T), sd(sc.b$yearsrn, na.rm=T),
                          sum(is.na(sc.a$yearsrn)), sum(is.na(sc.b$yearsrn))),
                        dim=c(2,6),
                        dimnames= list(Group=c("A", "B"), 
                                       Summary=c("Min", "Median", "Max", 
                                                 "Mean", "Std Dev", "Missing")))
kable(sc.yearsrn.sum)
sc.yearsrn.tt <- t.test(yearsrn~group, data=sc)
sc.yearsrn.tt
```

#### Years RN (without section 3)
```{r}
sc12.a.sum <- summary(sc12.a$yearsrn)
sc12.b.sum <- summary(sc12.b$yearsrn)
sc12.yearsrn.sum <- array(c(sc12.a.sum[1], sc12.b.sum[1],
                          sc12.a.sum[3], sc12.b.sum[3],
                          sc12.a.sum[6], sc12.b.sum[6],
                          sc12.a.sum[4], sc12.b.sum[4],
                          sd(sc12.a$yearsrn, na.rm=T), sd(sc12.b$yearsrn, na.rm=T),
                          sum(is.na(sc12.a$yearsrn)), sum(is.na(sc12.b$yearsrn))),
                        dim=c(2,6),
                        dimnames= list(Group=c("A", "B"), 
                                       Summary=c("Min", "Median", "Max", 
                                                 "Mean", "Std Dev", "Missing")))
kable(sc12.yearsrn.sum)
sc12.yearsrn.tt <- t.test(yearsrn~group, data=sc12)
sc12.yearsrn.tt 
```
#### Age (with section 3)
```{r}
sc.a.sum <- summary(sc.a$age)
sc.b.sum <- summary(sc.b$age)
sc.age.sum <- array(c(sc.a.sum[1], sc.b.sum[1],
                          sc.a.sum[3], sc.b.sum[3],
                          sc.a.sum[6], sc.b.sum[6],
                          sc.a.sum[4], sc.b.sum[4],
                          sd(sc.a$age, na.rm=T), sd(sc.b$age, na.rm=T),
                          sum(is.na(sc.a$age)), sum(is.na(sc.b$age))),
                        dim=c(2,6),
                        dimnames= list(Group=c("A", "B"), 
                                       Summary=c("Min", "Median", "Max", 
                                                 "Mean", "Std Dev", "Missing")))
kable(sc.age.sum)
sc.age.tt <- t.test(age~group, data=sc)
sc.age.tt
```

#### Age (without section 3)
```{r}
sc12.a.sum <- summary(sc12.a$age)
sc12.b.sum <- summary(sc12.b$age)
sc12.age.sum <- array(c(sc12.a.sum[1], sc12.b.sum[1],
                          sc12.a.sum[3], sc12.b.sum[3],
                          sc12.a.sum[6], sc12.b.sum[6],
                          sc12.a.sum[4], sc12.b.sum[4],
                          sd(sc12.a$age, na.rm=T), sd(sc12.b$age, na.rm=T),
                          sum(is.na(sc12.a$age)), sum(is.na(sc12.b$age))),
                        dim=c(2,6),
                        dimnames= list(Group=c("A", "B"), 
                                       Summary=c("Min", "Median", "Max", 
                                                 "Mean", "Std Dev", "Missing")))
kable(sc12.age.sum)
sc12.age.tt <- t.test(age~group, data=sc12)
sc12.age.tt
```

#### Gender (with section 3)
```{r}
sc.gender.ct <- table(sc$group, sc$gender)
kable(sc.gender.ct)
sc.gender.ft <- fisher.test(sc.gender.ct)
sc.gender.ft
```

#### Gender (without section 3)
```{r}
sc12.gender.ct <- table(sc12$group, sc12$gender)
kable(sc12.gender.ct)
sc12.gender.ft <- fisher.test(sc12.gender.ct)
sc12.gender.ft
```

#### Race (with section 3)
```{r}
sc.race.ct <- table(sc$group, sc$race)
kable(sc.race.ct)
sc.race.ft <- fisher.test(sc.race.ct)
sc.race.ft
```

#### Race (without section 3)
```{r}
sc12.race.ct <- table(sc12$group, sc12$race)
kable(sc12.race.ct)
sc12.race.ft <- fisher.test(sc12.race.ct)
sc12.race.ft
```

#### Summary

Age (p=`r sc.age.tt$p.value`, p=`r sc12.age.tt$p.value`) and gender (p=`r sc.gender.ft$p.value`, p=`r sc12.gender.ft$p.value`) showed no significant differences between groups, regardless of whether section 3 was included. Years RN (p=`r sc.yearsrn.tt$p.value`, p=`r sc12.yearsrn.tt$p.value`) was significantly different between groups, regardless of whether section 3 was included, and race showed significant differences between groups with section 3  (p=`r sc.race.ft$p.value`) and no significant difference without section 3  (p=`r sc12.race.ft$p.value`).

### Tests

Since years RN and race show significant differences between groups, those variables will be tested for effects on delta scores.

#### Years RN (with section 3)
```{r}
summary(lm(overall_delta~yearsrn, data=sc))
summary(lm(hr_delta~yearsrn, data=sc))
summary(lm(pa_delta~yearsrn, data=sc))
summary(lm(n_delta~yearsrn, data=sc))
summary(lm(sg_delta~yearsrn, data=sc))
summary(lm(ir_delta~yearsrn, data=sc))
summary(lm(sm_delta~yearsrn, data=sc))
```

#### Race (with section 3)
```{r}
summary(lm(overall_delta~race, data=sc))
summary(lm(hr_delta~race, data=sc))
summary(lm(pa_delta~race, data=sc))
summary(lm(n_delta~race, data=sc))
summary(lm(sg_delta~race, data=sc))
summary(lm(ir_delta~race, data=sc))
summary(lm(sm_delta~race, data=sc))
```

#### Group (with section 3)

Since years RN and race showed no significant interaction with any delta scores, one sided t tests will be conducted testing the alternative hypothesis that group A delta scores are larger than group B.

```{r}
t.test(overall_delta~group, data=sc, alt="g")
t.test(hr_delta~group, data=sc, alt="g")
t.test(pa_delta~group, data=sc, alt="g")
t.test(n_delta~group, data=sc, alt="g")
t.test(sg_delta~group, data=sc, alt="g")
t.test(ir_delta~group, data=sc, alt="g")
t.test(sm_delta~group, data=sc, alt="g")
```

### Results

While mean delta scores were larger in group A than group B for overall and each category, the only scores to be significantly larger are nutrition (p=`r t.test(n_delta~group, data=sc, alt="g")$p.value`) and spirital growth (p=`r t.test(sg_delta~group, data=sc, alt="g")$p.value`)